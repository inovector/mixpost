import{r as S,j as N,k as z,g,o,w as t,a as s,A as G,b as y,c as d,f as k,t as h,d as u,F as w,e as P,n as V,v as H,p as J,q as Q,s as X,z as Y,l as M,K as B,u as D,i as ee,H as te,c4 as j,b9 as se,D as I,N as A,Z as le,B as T}from"./app-CuAAy0_a.js";import{u as oe}from"./useNotifications-D5v1pCl1.js";import{l as O}from"./helpers-DwLxd2n_.js";import{_ as ae}from"./PageHeader-DVUMLPzB.js";import{_ as L,C as ne,a as ie,b as re}from"./PostsFilter-D-LOFnGs.js";import{_ as R,T as ue}from"./Tab-Be49vky2.js";import{_ as de}from"./Panel-BI1HlmuG.js";import{_ as U}from"./Checkbox-oVbYb678.js";import{_,a as K,T as ce}from"./TableCell-DmfvtO6s.js";import{a as me,_ as fe}from"./PureDangerButton-BIrgbd2l.js";import{_ as pe}from"./DangerButton-8ZkltBKU.js";import{u as ve}from"./SearchInput-FIUN2A_N.js";import{_ as _e}from"./MediaFile-CwEgSOxu.js";import{_ as q,h as ge,g as xe,a as be}from"./VerticallyScrollableContent-Bt2cPHRk.js";import{_ as E}from"./Account-BS2w7gSy.js";import{_ as ke}from"./Badge-Das4sLTQ.js";import{T as ye,_ as $e}from"./Trash-Drtb-HXt.js";import{_ as we}from"./NoResult-BucTPKga.js";import"./EllipsisVertical-BxQmXBmZ.js";import"./ProviderIcon-BY6BMjh6.js";import"./Input-DR7WxntX.js";import"./ExclamationCircle-CeCy-g-3.js";import"./Alert-RrK0zhzD.js";const he=()=>{const l=S([]),r=S([]),c=N({get(){return $(l.value)},set(){const a=l.value;if($(a)){x(a);return}p(a)}}),f=a=>{l.value=a},p=a=>{for(const n of a)b(n)||r.value.push(n)},i=a=>{let n=r.value.indexOf(a);n!==-1&&r.value.splice(n,1)},x=a=>{for(const n of a)i(n)},C=()=>{r.value=[]},b=a=>r.value.includes(a),$=a=>a.length?a.every(n=>b(n)):!1;return{selectedRecords:r,toggleSelectRecordsOnPage:c,putPageRecords:f,deselectRecord:i,deselectAllRecords:C}},Ce={class:"w-44"},De={key:0,class:"text-sm mt-xs text-gray-500"},Re={key:1,class:"text-sm mt-xs text-gray-500"},Pe={class:"w-96 text-left break-words"},Se={key:0,class:"w-48 flex relative"},Oe={key:0,class:"absolute top-0 -right-5 z-10"},Ve={class:"flex flex-wrap gap-xs"},Ne={class:"flex gap-xs"},Be={class:"mr-xs"},je={class:"text-left"},Ie={class:"mr-xs flex items-center"},Ae={__name:"PostItem",props:{item:{type:Object,required:!0},filter:{type:Object,default:{accounts:[]}}},setup(l){const r=l,{getOriginalVersion:c,getAccountVersion:f}=ve(),p=N(()=>{if(!r.item.versions.length)return{excerpt:"",media:null,media_count:0};let b=r.item.accounts;r.filter.accounts.length&&(b=b.filter(n=>r.filter.accounts.includes(n.id)));const $=b.map(n=>{const v=f(r.item.versions,n.id);return v?v.content[0]:c(r.item.versions).content[0]}),a=$.length?$[0]:r.item.versions[0].content[0];return{excerpt:a.excerpt,media:a.media.length?a.media[0]:null,media_count:a.media.length}}),i=S(!1),x=()=>{i.value=!0},C=()=>{i.value=!1};return(b,$)=>{const a=z("tooltip");return o(),g(K,{hoverable:!0},{default:t(()=>[s(_,{class:"w-10"},{default:t(()=>[G(b.$slots,"checkbox")]),_:3}),s(_,{clickable:!0,onClick:x},{default:t(()=>[y("div",Ce,[s(q,{value:l.item.status},null,8,["value"]),l.item.status==="SCHEDULED"?(o(),d("div",De,h(l.item.scheduled_at.human),1)):k("",!0),l.item.status==="PUBLISHED"?(o(),d("div",Re,h(l.item.published_at.human),1)):k("",!0)])]),_:1}),s(_,{clickable:!0,onClick:x,class:"pl-0!"},{default:t(()=>[y("div",Pe,h(p.value.excerpt),1)]),_:1}),s(_,{clickable:!0,onClick:x},{default:t(()=>[p.value.media?(o(),d("div",Se,[p.value.media?(o(),g(_e,{key:0,media:p.value.media,"img-height":"sm",imgWidthFull:!1,showCaption:!1},{default:t(()=>[p.value.media_count>1?(o(),d("div",Oe,[s(ke,null,{default:t(()=>[u("+"+h(p.value.media_count-1),1)]),_:1})])):k("",!0)]),_:1},8,["media"])):k("",!0)])):k("",!0)]),_:1}),s(_,{clickable:!0,onClick:x},{default:t(()=>[y("div",Ve,[(o(!0),d(w,null,P(l.item.tags,n=>(o(),g(ge,{key:n.id,item:n,removable:!1,editable:!1},null,8,["item"]))),128))])]),_:1}),s(_,null,{default:t(()=>[y("div",Ne,[(o(!0),d(w,null,P(l.item.accounts.slice(0,3),(n,v)=>(o(),d("div",{key:n.id,class:V({"-ml-6":v>0})},[H(s(E,{provider:n.provider,"img-url":n.image,active:!0},null,8,["provider","img-url"]),[[a,n.name]])],2))),128)),l.item.accounts.length>3?(o(),g(J,{key:0,"width-classes":"w-64",placement:"bottom-end"},{trigger:t(()=>[s(X,{class:"mt-4 font-semibold"},{default:t(()=>[u("+"+h(l.item.accounts.slice(3).length),1)]),_:1})]),content:t(()=>[s(xe,null,{default:t(()=>[(o(!0),d(w,null,P(l.item.accounts.slice(3),n=>(o(),g(Q,{as:"div"},{default:t(()=>[y("span",Be,[s(E,{provider:n.provider,"img-url":n.image,active:!0},null,8,["provider","img-url"])]),y("span",je,h(n.name),1)]),_:2},1024))),256))]),_:1})]),_:1})):k("",!0)])]),_:1}),s(_,null,{default:t(()=>[s(L,{"item-id":l.item.id},null,8,["item-id"])]),_:1}),s(Y,{show:i.value,scrollableBody:!0,onClose:C},{body:t(()=>[s(q,{value:l.item.status,class:"mb-lg"},null,8,["value"]),i.value?(o(),g(be,{key:0,accounts:l.item.accounts,versions:l.item.versions},null,8,["accounts","versions"])):k("",!0)]),footer:t(()=>[i.value?(o(),d(w,{key:0},[y("div",Ie,[s(L,{"item-id":l.item.id},null,8,["item-id"])]),s(M,{onClick:C},{default:t(()=>$[0]||($[0]=[u("Close")])),_:1,__:[0]})],64)):k("",!0)]),_:1},8,["show"])]),_:3})}}},Te={class:"bg-white border border-gray-100 rounded-lg p-sm w-fit"},Le={class:"flex flex-wrap items-center space-x-1"},F="px-sm py-xs rounded-md leading-4",Ue={__name:"Pagination",props:{meta:{type:Object,default:{current_page:1,from:1,last_page:1,per_page:2,to:1,total:0,links:[]}},links:{type:Object,default:{first:null,last:null,next:null,prev:null}}},setup(l){const r=l,c=N(()=>r.meta.links.map(f=>{const p=f.label.replace("&laquo; ","").replace(" &raquo;","");return{active:f.active,url:f.url,label:p,component:isNaN(parseInt(f.label))?{Next:ie,Previous:ne}[p]:null}}));return(f,p)=>(o(),d("div",Te,[y("div",Le,[(o(!0),d(w,null,P(c.value,(i,x)=>(o(),d(w,null,[i.url===null?(o(),d("div",{key:x,class:V([[F,{"px-0!":i.label==="...","px-xs!":i.component}],"text-gray-400"])},[i.component?(o(),g(B(i.component),{key:0})):(o(),d(w,{key:1},[u(h(i.label),1)],64))],2)):(o(),g(D(ee),{key:`link-${x}`,disabled:"",class:V(["transition-colors ease-in-out duration-200",[F,{"bg-indigo-500 text-white":i.active,"hover:text-indigo-500 focus:text-indigo-500":!i.active,"px-xs!":i.component}]]),href:i.url},{default:t(()=>[i.component?(o(),g(B(i.component),{key:0})):(o(),d(w,{key:1},[u(h(i.label),1)],64))]),_:2},1032,["class","href"]))],64))),256))])]))}},qe={class:"row-py mb-2xl"},Ee={class:"w-full row-px"},Fe={class:"w-full row-px mt-lg"},ze={key:0,class:"mt-lg"},ft={__name:"Index",props:{filter:{type:Object,default:{}},posts:{type:Object},has_failed_posts:{type:Boolean,default:!1}},setup(l){const r=l,c=S({keyword:r.filter.keyword,status:r.filter.status,tags:r.filter.tags,accounts:r.filter.accounts}),{selectedRecords:f,putPageRecords:p,toggleSelectRecordsOnPage:i,deselectRecord:x,deselectAllRecords:C}=he(),b=()=>r.posts.data.map(v=>v.id);te(()=>{p(b()),j.on("postDelete",v=>{x(v)})}),se(()=>{j.off("postDelete")}),I(()=>O.cloneDeep(c.value),O.throttle(()=>{A.get(route("mixpost.posts.index"),O.pickBy(c.value),{preserveState:!0,only:["posts","filter"]})},300)),I(()=>r.posts.data,()=>{p(b())});const{notify:$}=oe(),a=S(!1),n=()=>{A.delete(route("mixpost.posts.multipleDelete"),{data:{posts:f.value,status:c.value.status},onSuccess(){C(),$("success","Selected posts deleted")},onFinish(){a.value=!1}})};return(v,e)=>{const W=z("tooltip");return o(),d(w,null,[s(D(le),{title:"Posts"}),y("div",qe,[s(ae,{title:"Posts"},{default:t(()=>[s(re,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=m=>c.value=m),class:"ml-2"},null,8,["modelValue"])]),_:1}),y("div",Ee,[s(ue,null,{default:t(()=>[s(R,{onClick:e[1]||(e[1]=m=>c.value.status=null),active:!v.$page.props.filter.status},{default:t(()=>e[11]||(e[11]=[u("All")])),_:1,__:[11]},8,["active"]),s(R,{onClick:e[2]||(e[2]=m=>c.value.status="draft"),active:v.$page.props.filter.status==="draft"},{default:t(()=>e[12]||(e[12]=[u("Drafts")])),_:1,__:[12]},8,["active"]),s(R,{onClick:e[3]||(e[3]=m=>c.value.status="scheduled"),active:v.$page.props.filter.status==="scheduled"},{default:t(()=>e[13]||(e[13]=[u("Scheduled")])),_:1,__:[13]},8,["active"]),s(R,{onClick:e[4]||(e[4]=m=>c.value.status="published"),active:v.$page.props.filter.status==="published"},{default:t(()=>e[14]||(e[14]=[u("Published")])),_:1,__:[14]},8,["active"]),l.has_failed_posts?(o(),g(R,{key:0,onClick:e[5]||(e[5]=m=>c.value.status="failed"),active:v.$page.props.filter.status==="failed",class:"text-red-500"},{default:t(()=>e[15]||(e[15]=[u("Failed")])),_:1,__:[15]},8,["active"])):k("",!0)]),_:1})]),y("div",Fe,[s(fe,{count:D(f).length,onClose:D(C)},{default:t(()=>[H((o(),g(me,{onClick:e[6]||(e[6]=m=>a.value=!0)},{default:t(()=>[s(ye)]),_:1})),[[W,"Delete"]])]),_:1},8,["count","onClose"]),s(de,{"with-padding":!1},{default:t(()=>[s(ce,null,{head:t(()=>[s(K,null,{default:t(()=>[s(_,{component:"th",scope:"col",class:"w-10"},{default:t(()=>[s(U,{checked:D(i),"onUpdate:checked":e[7]||(e[7]=m=>T(i)?i.value=m:null),disabled:!l.posts.meta.total},null,8,["checked","disabled"])]),_:1}),s(_,{component:"th",scope:"col",class:"w-44"},{default:t(()=>e[16]||(e[16]=[u("Status")])),_:1,__:[16]}),s(_,{component:"th",scope:"col",class:"pl-0! text-left"},{default:t(()=>e[17]||(e[17]=[u("Content")])),_:1,__:[17]}),s(_,{component:"th",scope:"col",class:"w-48"},{default:t(()=>e[18]||(e[18]=[u("Media")])),_:1,__:[18]}),s(_,{component:"th",scope:"col"},{default:t(()=>e[19]||(e[19]=[u("Labels")])),_:1,__:[19]}),s(_,{component:"th",scope:"col"},{default:t(()=>e[20]||(e[20]=[u("Accounts")])),_:1,__:[20]}),s(_,{component:"th",scope:"col"})]),_:1})]),body:t(()=>[(o(!0),d(w,null,P(l.posts.data,m=>(o(),g(Ae,{key:m.id,item:m,filter:l.posts.filter,onOnDelete:()=>{D(x)(m.id)}},{checkbox:t(()=>[s(U,{checked:D(f),"onUpdate:checked":e[8]||(e[8]=Z=>T(f)?f.value=Z:null),value:m.id,number:""},null,8,["checked","value"])]),_:2},1032,["item","filter","onOnDelete"]))),128))]),_:1}),l.posts.meta.total?k("",!0):(o(),g(we,{key:0,class:"py-md px-md"},{default:t(()=>e[21]||(e[21]=[u("No posts found.")])),_:1,__:[21]}))]),_:1}),l.posts.meta.links.length>3?(o(),d("div",ze,[s(Ue,{meta:l.posts.meta,links:l.posts.links},null,8,["meta","links"])])):k("",!0)])]),s($e,{show:a.value,variant:"danger",onClose:e[10]||(e[10]=m=>a.value=!1)},{header:t(()=>e[22]||(e[22]=[u(" Delete posts ")])),body:t(()=>e[23]||(e[23]=[u(" Are you sure you want to delete selected posts? ")])),footer:t(()=>[s(M,{onClick:e[9]||(e[9]=m=>a.value=!1),class:"mr-xs"},{default:t(()=>e[24]||(e[24]=[u("Cancel")])),_:1,__:[24]}),s(pe,{onClick:n},{default:t(()=>e[25]||(e[25]=[u("Delete")])),_:1,__:[25]})]),_:1},8,["show"])],64)}}};export{ft as default};
